<div class="agendar-wrapper">
  <h2>Agendar Reserva</h2>

  <form #reservaForm="ngForm" (ngSubmit)="generarReserva()" class="form-grid">

    <!-- ====== COLUMNA IZQUIERDA (datos del cliente y del evento) ====== -->
    <section class="col-left">
      <div class="field">
        <label>Cédula</label>
        <input type="text" [(ngModel)]="formReserva.ci" name="ci" disabled />
      </div>

      <div class="field">
        <label>Nombre</label>
        <input type="text" [(ngModel)]="formReserva.nombre" name="nombre" disabled />
      </div>

      <div class="field">
        <label>Teléfono</label>
        <input type="text" [(ngModel)]="formReserva.telefono" name="telefono" disabled />
      </div>

      <div class="field">
        <label>Dirección</label>
        <input type="text" [(ngModel)]="formReserva.direccion" name="direccion" disabled />
      </div>

      <div class="field">
        <label>Correo electrónico</label>
        <input type="text" [(ngModel)]="formReserva.e_mail" name="e_mail" disabled />
      </div>

      
    </section>

    <!-- divisor vertical -->
    <div class="divider"></div>

    <!-- ====== COLUMNA DERECHA (selección de menús) ====== -->
    <section class="col-right">

      <div class="field date-field">
        <label>Fecha de evento</label>
        <input
          type="date"
          [(ngModel)]="formReserva.fechaevento"
          name="fechaevento"
          required
        />
        <mat-icon class="date-icon">calendar</mat-icon>
      </div>

      <div class="field">
        <label>Dirección del evento</label>
        <input
          type="text"
          [(ngModel)]="formReserva.direccionevento"
          name="direccionevento"
          required
        />
      </div>

      <div class="select-row">
        <div class="field">
          <label>Menú</label>
          <select #selectMenu>
            <option value="">Seleccione</option>
            <option *ngFor="let m of menus" [value]="m.idmenu">{{ m.nombre }}</option>
          </select>
        </div>

        <div class="field small">
          <label>Cantidad</label>
          <input type="number" #cantRef min="1" />
        </div>

        <button
          type="button"
          class="icon-button"
          (click)="agregarMenuDesdeSelect(selectMenu.value, cantRef.value)"
          aria-label="Agregar menú"
        >
          <mat-icon>add</mat-icon>
        </button>
      </div>
      <p></p>


      <h3 class="section-title" >Menús seleccionados</h3>

      <div class="table-wrapper">
        <table class="tabla">
          <thead>
            <tr>
              <th>Menú</th>
              <th>Servicio</th>
              <th>Precio </th>
              <th>Cantidad</th>
              <th>Subtotal</th>
              <th class="acciones-col"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let sel of menusSeleccionados; let i = index">
              <td>{{ sel.nombre }}</td>
              <td>{{ sel.servicioName }}</td>
              <td>{{ sel.precioUnitario }}</td>
              <td>{{ sel.cantpersonas }}</td>
              <td>{{ sel.subtotal }}</td>
              <td class="acciones-col">
                <button type="button" class="icon-button danger" (click)="quitarMenuSeleccionado(i)">
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="totales">
        <span>Total</span>
        <strong>{{ formReserva.total | number:'1.2-2' }}</strong>
      </div>

      <button
        type="submit"
        class="generate-button"
        [disabled]="!reservaForm.form.valid"
      >
        Generar reserva
      </button>
    </section>

  </form>

  <button mat-icon-button class="btn-back" (click)="volver()" aria-label="Volver">
    <mat-icon>arrow_back</mat-icon>
  </button>
</div>
