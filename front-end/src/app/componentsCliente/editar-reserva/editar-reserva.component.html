<div class="edit-sheet">
  <h2 class="sheet-title">Editar reserva</h2>

  <!-- Cabecera -->
  <div class="meta-grid">
    <div class="form-field">
      <label class="field-label">Fecha del evento</label>
      <input
        type="date"
        [(ngModel)]="reserva.fechaevento"
        (change)="recalcularCabecera()"
        class="field-input"
      />
    </div>

    <div class="form-field">
      <label class="field-label">Dirección del evento</label>
      <input
        type="text"
        [(ngModel)]="reserva.direccionevento"
        (input)="recalcularCabecera()"
        class="field-input"
        placeholder="Calle, número y referencia"
      />
    </div>
  </div>

  <!-- Menús -->
  <div class="toolbar">
    <div class="toolbar-left">
      <h3 class="toolbar-title">Menús seleccionados</h3>
    </div>
    <button (click)="agregarDetalle()" class="btn add-button">
      <i class="fa fa-plus"></i> Agregar Menú
    </button>
  </div>

  <div class="table-wrap">
    <table class="tabla">
      <thead>
        <tr>
          <th>Menú</th>
          <th>Cantidad</th>
          <th>Precio</th>
          <th>Subtotal</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let d of reserva.detalles; let i = index">
          <!-- Menú -->
          <td>
            <select
              class="field-input"
              [(ngModel)]="d.idmenu"
              (change)="onMenuSelectChange(i, d.idmenu)"
              [ngModelOptions]="{ standalone: true }"
            >
              <option value="">-- Seleccione --</option>
              <option *ngFor="let m of menusDisponibles" [value]="m.idmenu">
                {{ m.nombre }}
              </option>
            </select>
          </td>

          <!-- Cantidad -->
          <td class="col-cantidad">
            <input
              type="number"
              class="field-input qty-input"
              [(ngModel)]="d.cantpersonas"
              (input)="onCantidadChange(i, d.cantpersonas)"
              [ngModelOptions]="{ standalone: true }"
              min="1"
            />
          </td>

          <!-- Precio -->
          <td class="mono">${{ d.preciounitario }}</td>

          <!-- Subtotal -->
          <td class="mono">${{ d.subtotal }}</td>

          <!-- Eliminar -->
          <td class="col-actions">
            <button type="button" class="btn icon danger" (click)="quitarDetalle(i)" aria-label="Eliminar">
              <i class="fa fa-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Resumen -->
  <div class="summary">
    <div class="summary-item"><span>Total:</span> <strong>${{ reserva.total }}</strong></div>
    <div class="summary-item"><span>Cantidad:</span> <strong>{{ reserva.cantpersonas }}</strong></div>
  </div>

  <!-- Acciones -->
  <div class="actions">
    <button (click)="guardarEdicion()" class="btn primary">
      <i class="fa fa-save"></i> Guardar
    </button>
    <button (click)="cancelarEdicion()" class="btn ghost">
      <i class="fa fa-times"></i> Cancelar
    </button>
  </div>
</div>
